<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>13æœˆäº®æ›†ãƒ»ç¥å»ŸçŸ³ç¢‘ï¼ˆGEMINIï¼‰</title>

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@900&family=Noto+Serif+TC:wght@500;700;900&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="./red-brain.js"></script>

  <style>
    /* é€™è£¡å®Œæ•´ä¿ç•™ä½ ç¬¬ä¸€ç‰ˆçš„çŸ³ç¢‘ç¾å­¸ CSS */
    :root{
      --theme:#A5413F;
      --bg:#F8E8E8;
      --ink:#111;
    }

    html, body {
      width: 100%; height: 100%; margin: 0; padding: 0;
      background: var(--bg);
      font-family: 'Noto Serif TC', serif;
      overflow: hidden;
      display: flex; align-items: center; justify-content: center;
      transition: background-color 1.1s ease;
    }

    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none;
      background:
        radial-gradient(900px 650px at 50% 32%, rgba(255,255,255,.42), transparent 60%),
        radial-gradient(1200px 900px at 50% 92%, rgba(0,0,0,.14), transparent 66%);
      mix-blend-mode: multiply; opacity: .9;
    }

    .history-sidebar {
      position: fixed; left: 42px; top: 50%; transform: translateY(-50%);
      display: flex; flex-direction: column; gap: 16px; z-index: 100;
    }
    .history-stone {
      width: 76px; height: 70px;
      border-radius: 40% 60% 70% 30% / 50% 40% 60% 50%;
      background: linear-gradient(180deg, #F5F2EC, #E6E1DA);
      box-shadow: 0 18px 34px rgba(0,0,0,.22), inset 0 2px 10px rgba(0,0,0,.14), inset 0 1px 0 rgba(255,255,255,.55);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Cinzel', serif; font-weight: 900; font-size: 1.12rem;
      color: #222; cursor: pointer; user-select: none;
      transition: all 0.18s ease;
    }

    .tablet {
      width: min(760px, 92vw);
      height: min(880px, 90vh);
      position: relative; border-radius: 56px;
      background: linear-gradient(180deg, #F1EFE8, #E6E0D6);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 60px 110px rgba(0,0,0,.32), 0 14px 22px rgba(0,0,0,.18);
      overflow: hidden; display: flex; flex-direction: column; align-items: center;
      z-index: 10;
    }

    .tablet::after {
      content: ""; position: absolute; inset: 0; pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 220 220' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.55'/%3E%3C/svg%3E");
      opacity: .12; mix-blend-mode: multiply;
    }

    .content {
      position: relative; z-index: 20; width: 100%; height: 100%;
      padding: 40px clamp(24px, 3.4vw, 48px);
      display: flex; flex-direction: column; align-items: center;
      box-sizing: border-box;
    }

    /* èª¿æ€§å€ */
    .tone-area {
      height: 100px; width: 100%; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 12px;
    }
    .tone-dots { display: flex; align-items: center; gap: 14px; }
    .tone-bars { display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .tone-dot { width: 22px; height: 22px; background: #000; border-radius: 50%; }
    .tone-bar { width: 190px; height: 16px; background: #000; border-radius: 8px; }

    /* åœ–é¨°å€ */
    .glyph-area { width: 100%; display: flex; justify-content: center; align-items: center; margin-bottom: 6px; }
    .glyph-frame {
      display: inline-flex; padding: 10px; border-radius: 24px;
      background: rgba(255,255,255,.12); border: 1px solid rgba(0,0,0,.14);
      box-shadow: inset 0 4px 20px rgba(0,0,0,.30), 0 14px 28px rgba(0,0,0,.18);
      cursor: pointer;
    }
    .glyph-img { height: 180px; border-radius: 16px; filter: drop-shadow(0 12px 18px rgba(0,0,0,.24)); }

    /* æ–‡å­—èˆ‡é †åº */
    .kin-id { font-family: 'Cinzel', serif; font-size: 3.5rem; font-weight: 900; color: #0E0E0E; margin-top: 8px; cursor: pointer; }
    .kin-name { font-size: 2.4rem; font-weight: 900; letter-spacing: 6px; color: #111; margin-top: 2px; }
    .kin-wavespell {
      display: flex; align-items: center; justify-content: center; gap: 10px;
      margin-top: 6px; font-size: 1.1rem; font-weight: 700; color: #555; letter-spacing: 2px;
    }
    .wavespell-icon-inline { width: 28px; height: 28px; filter: drop-shadow(0 2px 4px rgba(0,0,0,.18)); }
    .name-etch {
      width: 60%; height: 10px; border-radius: 999px;
      background: linear-gradient(90deg, transparent 0%, var(--theme) 50%, transparent 100%);
      opacity: .6; margin: 15px auto;
    }

    /* ç¸®å°æ¨¡å¼ */
    .compact .tone-area { height: 60px; }
    .compact .glyph-img { height: 105px; }
    .compact .kin-id { font-size: 2rem; }
    .compact .kin-name { font-size: 1.5rem; }

    /* å°é »ä¸­çš„é™°å½±æ–¹å¡Šï¼šé‚„åŸç¬¬ä¸€ç‰ˆæ¨£å¼ */
    .spinning-placeholder {
      width: 94%; background: rgba(245,242,236,.3); border-radius: 32px;
      padding: 40px 20px; border: 1px solid rgba(0,0,0,.1);
      box-shadow: inset 0 3px 12px rgba(0,0,0,0.15);
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; color: var(--theme); letter-spacing: 2px;
      font-size: 1.2rem; margin-top: 10px;
    }

    /* è¨Šæ¯å€ */
    .msg-stack { width: 94%; display: flex; flex-direction: column; gap: 16px; animation: slideInUp 0.7s forwards; }
    @keyframes slideInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
    .msg-box {
      background: rgba(245,242,236,.66); border-radius: 32px;
      padding: 24px 34px; border: 1px solid rgba(0,0,0,.12);
      box-shadow: inset 0 3px 16px rgba(0,0,0,.24), 0 12px 20px rgba(0,0,0,.14);
      backdrop-filter: blur(3px);
    }
    .label { font-weight: 900; opacity: .64; margin-bottom: 12px; display: block; text-align: center; }
    .content-text { font-size: 1.4rem; line-height: 1.9; font-weight: 900; color: #0B0B0B; }

    /* å°é¢æ¨£å¼å®Œå…¨é‚„åŸ */
    .pre-card {
      width: min(680px, 88%); border-radius: 56px; background: rgba(255,255,255,.11); border: 2px solid rgba(0,0,0,.09);
      box-shadow: 0 52px 98px rgba(0,0,0,.24), inset 0 3px 20px rgba(0,0,0,.20), inset 0 -1px 0 rgba(255,255,255,.38);
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 26px; padding: 50px 20px; cursor: pointer;
    }
    .pre-inner {
      width: 240px; height: 240px; border-radius: 38px; border: 3px solid rgba(0,0,0,.11);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 24px 42px rgba(0,0,0,.20), inset 0 2px 14px rgba(0,0,0,.14);
      background: rgba(255,255,255,.08); color: var(--theme); font-weight: 900; font-size: 1.15rem;
    }
    .footer-indicator { margin-top: auto; padding-bottom: 30px; width: 240px; display: flex; justify-content: center; gap: 12px; }
    .footer-indicator::before { content: ""; width: 13px; height: 13px; border-radius: 50%; background: var(--theme); }
    .footer-indicator::after { content: ""; width: 164px; height: 13px; border-radius: 13px; background: var(--theme); }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const TONE_NAMES = ["ç£æ€§çš„", "æœˆäº®çš„", "é›»åŠ›çš„", "è‡ªæˆ‘å­˜åœ¨çš„", "è¶…é »çš„", "éŸ»å¾‹çš„", "å…±é³´çš„", "éŠ€æ²³çš„", "å¤ªé™½çš„", "è¡Œæ˜Ÿçš„", "å…‰è­œçš„", "æ°´æ™¶çš„", "å®‡å®™çš„"];
    const GLYPH_NAMES = ["ç´…é¾", "ç™½é¢¨", "è—å¤œ", "é»ƒç¨®å­", "ç´…è›‡", "ç™½ä¸–ç•Œæ©‹", "è—æ‰‹", "é»ƒæ˜Ÿæ˜Ÿ", "ç´…æœˆ", "ç™½ç‹—", "è—çŒ´", "é»ƒäºº", "ç´…å¤©è¡Œè€…", "ç™½å·«å¸«", "è—é·¹", "é»ƒæˆ°å£«", "ç´…åœ°çƒ", "ç™½é¡", "è—é¢¨æš´", "é»ƒå¤ªé™½"];
    const WAVESPELL_DATA = [
      { name: "ç´…é¾æ³¢", glyphId: 0 }, { name: "ç™½å·«å¸«æ³¢", glyphId: 13 }, { name: "è—æ‰‹æ³¢", glyphId: 6 }, { name: "é»ƒå¤ªé™½æ³¢", glyphId: 19 },
      { name: "ç´…å¤©è¡Œè€…æ³¢", glyphId: 12 }, { name: "ç™½ä¸–ç•Œæ©‹æ³¢", glyphId: 5 }, { name: "è—é¢¨æš´æ³¢", glyphId: 18 }, { name: "é»ƒäººæ³¢", glyphId: 11 },
      { name: "ç´…è›‡æ³¢", glyphId: 4 }, { name: "ç™½é¡æ³¢", glyphId: 17 }, { name: "è—çŒ´æ³¢", glyphId: 10 }, { name: "é»ƒç¨®å­æ³¢", glyphId: 3 },
      { name: "ç´…åœ°çƒæ³¢", glyphId: 16 }, { name: "ç™½ç‹—æ³¢", glyphId: 9 }, { name: "è—å¤œæ³¢", glyphId: 2 }, { name: "é»ƒæˆ°å£«æ³¢", glyphId: 15 },
      { name: "ç´…æœˆæ³¢", glyphId: 8 }, { name: "ç™½é¢¨æ³¢", glyphId: 1 }, { name: "è—é·¹æ³¢", glyphId: 14 }, { name: "é»ƒæ˜Ÿæ˜Ÿæ³¢", glyphId: 7 }
    ];

    const THEME = {
      red: { main: "#A5413F", bg: "#F8E8E8" },
      white: { main: "#666666", bg: "#F2F4F6" },
      blue: { main: "#3D5A73", bg: "#E8F0F8" },
      yellow: { main: "#B39B59", bg: "#F9F8E8" }
    };

    function getWavespell(kin) { return WAVESPELL_DATA[Math.floor((kin - 1) / 13)]; }

    function RedRoom() {
      const [kin, setKin] = useState(1);
      const [history, setHistory] = useState([]);
      const [spinning, setSpinning] = useState(false);
      const [hasDrawn, setHasDrawn] = useState(false);
      const [showMessage, setShowMessage] = useState(false);
      const [isCompact, setIsCompact] = useState(false);
      const timerRef = useRef(null);

      const toneId = (kin - 1) % 13 + 1;
      const glyphId = (kin - 1) % 20;
      const wavespell = getWavespell(kin);
      const theme = THEME[['red', 'white', 'blue', 'yellow'][(kin - 1) % 4]];
      const brain = window.RED_BRAIN_DATA || {};
      const data = brain[String(kin)] || { synchronicMessage: "èƒ½é‡èª¿é »ä¸­...", alignment: "æ­£åœ¨è®€å–è¨Šæ¯..." };

      useEffect(() => {
        document.documentElement.style.setProperty("--bg", theme.bg);
        document.documentElement.style.setProperty("--theme", theme.main);
      }, [theme]);

      const startSpin = () => {
        setHasDrawn(true); setSpinning(true); setShowMessage(false); setIsCompact(false);
        if (timerRef.current) clearInterval(timerRef.current);
        timerRef.current = setInterval(() => { setKin(Math.floor(Math.random() * 260) + 1); }, 70);
      };

      const stopSpin = () => {
        clearInterval(timerRef.current);
        setSpinning(false);
        setTimeout(() => { setIsCompact(true); setTimeout(() => setShowMessage(true), 150); }, 1000);
        setHistory(prev => [kin, ...prev].slice(0, 5));
      };

      const manualInput = () => {
        const num = prompt("å¬å–šæŒ‡å®š KIN (1-260):", kin);
        const n = parseInt(num, 10);
        if (!Number.isNaN(n) && n >= 1 && n <= 260) {
          setHasDrawn(true); setKin(n); setShowMessage(false); setIsCompact(false);
          setTimeout(() => { setIsCompact(true); setTimeout(() => setShowMessage(true), 150); }, 1000);
        }
      };

      return (
        <>
          <div className="history-sidebar">
            {history.map((k, i) => (
              <div key={i} className="history-stone" onClick={() => !spinning && setKin(k)}>{k}</div>
            ))}
          </div>

          <div className="tablet">
            <div className={`content ${isCompact ? 'compact' : ''}`}>
              {!hasDrawn ? (
                <>
                  <div className="pre-card" onClick={startSpin}>
                    <div className="pre-inner">èª¿é »æº–å‚™ä¸­â€¦</div>
                    <div className="pre-title">é»æ“Šé–‹å§‹èª¿é »</div>
                    <div className="pre-sub">è·Ÿè‘—ç›´è¦ºï¼Œé–å®šå°è¨˜</div>
                  </div>
                  <div className="footer-indicator"></div>
                </>
              ) : (
                <>
                  {/* é‡é»ï¼šå°é »æ™‚éš±è—èª¿æ€§ */}
                  {!spinning && (
                    <div className="tone-area">
                      <div className="tone-dots">
                        {[...Array(toneId % 5)].map((_, i) => <div key={i} className="tone-dot"></div>)}
                      </div>
                      {Math.floor(toneId / 5) > 0 && (
                        <div className="tone-bars">
                          {[...Array(Math.floor(toneId / 5))].map((_, i) => <div key={i} className="tone-bar"></div>)}
                        </div>
                      )}
                    </div>
                  )}

                  {/* åœ–é¨° */}
                  <div className="glyph-area">
                    <div className="glyph-frame" onClick={spinning ? stopSpin : startSpin}>
                      <img className="glyph-img" src={`../images/${String(glyphId + 1).padStart(2, '0')}.png`} />
                    </div>
                  </div>

                  {/* åš´æ ¼é †åºï¼šKIN -> åç¨± -> æ³¢ç¬¦ -> åˆ»ç—• */}
                  <div className="kin-id" onClick={manualInput}>KIN {kin}</div>
                  <div className="kin-name">{TONE_NAMES[toneId - 1]}{GLYPH_NAMES[glyphId]}</div>
                  <div className="kin-wavespell">
                    <img className="wavespell-icon-inline" src={`../images/${String(wavespell.glyphId + 1).padStart(2, '0')}.png`} alt={wavespell.name} />
                    <span>{wavespell.name}</span>
                  </div>
                  <div className="name-etch"></div>

                  {/* å°é »ä¸­çš„é™°å½±æ¡†ï¼šåªåœ¨ Spinning æ™‚é¡¯ç¤º */}
                  {spinning ? (
                    <div className="spinning-placeholder">
                      å°é »ä¸­â€¦ (åœæ­¢å¾Œé¡¯ç¤ºå®Œæ•´è¨Šæ¯)
                    </div>
                  ) : showMessage && (
                    <div className="msg-stack">
                      <div className="msg-box">
                        <span className="label">âš¡ èƒ½é‡æ„Ÿæ‡‰</span>
                        <div className="content-text">{data.synchronicMessage}</div>
                      </div>
                      <div className="msg-box">
                        <span className="label">ğŸŒ± èª¿é »å»ºè­°</span>
                        <div className="content-text">{data.alignment}</div>
                      </div>
                    </div>
                  )}
                </>
              )}
            </div>
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<RedRoom />);
  </script>
</body>
</html>