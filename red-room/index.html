<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>13æœˆäº®æ›†ãƒ»ç¥å»ŸçŸ³ç¢‘</title>

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@900&family=Noto+Serif+TC:wght@500;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- ä½ çš„è³‡æ–™ä¾†æºï¼ˆç…§ä½ åŸæœ¬è·¯å¾‘ï¼‰ -->
  <script src="./red-brain.js"></script>

  <style>
    :root{
      --theme:#A5413F;
      --bg:#F8E8E8;
      --ink:#111;
    }

    html,body{
      width:100%;
      height:100%;
      margin:0;
      background:var(--bg);
      font-family:'Noto Serif TC', serif;
      overflow:hidden;
      transition: background-color 1.1s ease;
    }

    /* èƒŒæ™¯æŸ”éœ§ï¼ˆä¸åƒå­—ï¼‰ */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 650px at 50% 32%, rgba(255,255,255,.42), transparent 60%),
        radial-gradient(1200px 900px at 50% 92%, rgba(0,0,0,.14), transparent 66%);
      mix-blend-mode:multiply;
      opacity:.9;
    }

    /* å·¦å´è¨˜éŒ„çŸ³ï¼šä¸è¦å‰‡çŸ³é ­å½¢ */
    .history-sidebar{
      position:fixed;
      left:42px;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      flex-direction:column;
      gap:16px;
      z-index:50;
    }
    .history-stone{
      width:76px;
      height:70px;
      border-radius:40% 60% 70% 30% / 50% 40% 60% 50%;
      background:linear-gradient(180deg,#F5F2EC,#E6E1DA);
      box-shadow:
        0 18px 34px rgba(0,0,0,.22),
        inset 0 2px 10px rgba(0,0,0,.14),
        inset 0 1px 0 rgba(255,255,255,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#222;
      font-family:'Cinzel', serif;
      font-weight:900;
      font-size:1.12rem;
      cursor:pointer;
      user-select:none;
      transition:.18s;
    }
    .history-stone:hover{ transform:translateY(-2px) scale(1.03); }

    /* ä¸»çŸ³ç¢‘ï¼ˆå›ºå®šé«˜åº¦ï¼Œå‚ç›´ç½®ä¸­ï¼‰ */
    .tablet{
      width:min(760px,92vw);
      height:min(880px,90vh);
      margin:0 auto;
      position:relative;
      border-radius:56px;
      background:linear-gradient(180deg,#F1EFE8,#E6E0D6);
      border:1px solid rgba(0,0,0,.10);
      box-shadow: 0 60px 110px rgba(0,0,0,.32), 0 14px 22px rgba(0,0,0,.18);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    /* çŸ³ç¢‘ç´‹ç† */
    .tablet::after{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(0,0,0,.10), transparent 55%),
        radial-gradient(circle at 70% 60%, rgba(0,0,0,.08), transparent 60%),
        url("data:image/svg+xml,%3Csvg viewBox='0 0 220 220' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.55'/%3E%3C/svg%3E");
      opacity:.16;
      mix-blend-mode:multiply;
    }

    /* å…§å®¹å®¹å™¨ï¼šç”¨ã€Œä¸Šåˆ°ä¸‹ã€*/
    .content{
      position:relative;
      z-index:5;
      width:100%;
      height:100%;
      padding:clamp(28px, 4vh, 52px) clamp(24px, 3.4vw, 48px) clamp(24px, 3vh, 40px);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:clamp(6px, 1.2vh, 14px);
      min-height:0;
    }

    /* èª¿æ€§å€ï¼šå›ºå®šé«˜åº¦ï¼ˆä¸æœƒå†é»åœ–é¨°ï¼‰ */
    .tone-area{
      height:96px;
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      padding-top:6px;
      gap:10px;
      flex:0 0 96px;
    }
    .tone-dots{
      height:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
    }
    .tone-bars{
      height:42px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
    }
    .tone-dot{ width:22px; height:22px; background:#000; border-radius:50%; }
    .tone-bar{ width:190px; height:16px; background:#000; border-radius:8px; }

    /* åœ–é¨°ï¼šç¨ç«‹å€å¡Šä½”ä½ */
    .glyph-area{
      width:100%;
      display:flex;
      justify-content:center;
      margin-top:-2px;
      margin-bottom:6px;
      flex:0 0 200px;
      align-items:center;
    }
    .glyph-frame{
      display:inline-flex;
      padding:10px;
      border-radius:24px;
      background:rgba(255,255,255,.12);
      border:1px solid rgba(0,0,0,.14);
      box-shadow:
        inset 0 4px 20px rgba(0,0,0,.30),
        inset 0 -6px 16px rgba(255,255,255,.24),
        0 14px 28px rgba(0,0,0,.18);
      cursor:pointer;
      user-select:none;
      transition: transform .2s ease;
    }
    .glyph-frame:hover{ transform: translateY(-2px); }
    .glyph-img{
      height:180px;
      border-radius:16px;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.24));
    }

    /* KINï¼šå›ºå®šå¯¬åº¦é¿å…ä½æ•¸è·³å‹• */
    .kin-id{
      font-family:'Cinzel', serif;
      font-size:clamp(2.8rem, 4.8vh, 3.8rem);
      font-weight:900;
      line-height:1;
      margin-top:2px;
      min-width:9ch;
      text-align:center;
      font-variant-numeric: tabular-nums;
      font-feature-settings:"tnum" 1;
      user-select:none;
      cursor:pointer;
      color:#0E0E0E;
      flex:0 0 auto;
    }
    .kin-name{
      font-size:clamp(1.65rem, 3.2vh, 2.35rem);
      font-weight:900;
      letter-spacing:clamp(3px, .9vw, 7px);
      margin-top:4px;
      text-align:center;
      color:#111;
      flex:0 0 auto;
    }

    /* æ¼¸å±¤åˆ»ç—•ï¼šå›ºå®šæ”¾åœ¨ã€Œåç¨±åº•ä¸‹ã€*/
    .name-etch{
      width:64%;
      height:12px;
      border-radius:999px;
      background:linear-gradient(90deg, transparent 0%, var(--theme) 50%, transparent 100%);
      opacity:.64;
      margin:10px auto 12px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.14));
      flex:0 0 auto;
    }

    /* è¨Šæ¯å€ï¼šä¸Šä¸‹æ’åˆ— + æ»‘å…¥å‹•ç•« + å…§éƒ¨æ²å‹• */
    .msg-stack{
      width:92%;
      display:flex;
      flex-direction:column;
      gap:clamp(12px, 1.5vh, 18px);
      margin-top:0;
      flex:1 1 auto;
      min-height:0;
      overflow-y:auto;
      padding-right:6px;
      animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      opacity:0;
    }

    /* ç¥å»Ÿé¢¨æ ¼æ²è»¸ */
    .msg-stack::-webkit-scrollbar{
      width:5px;
    }
    .msg-stack::-webkit-scrollbar-track{
      background:rgba(0,0,0,.04);
      border-radius:10px;
    }
    .msg-stack::-webkit-scrollbar-thumb{
      background:rgba(0,0,0,.16);
      border-radius:10px;
    }
    .msg-stack::-webkit-scrollbar-thumb:hover{
      background:rgba(0,0,0,.26);
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .msg-box{
      background:rgba(245,242,236,.66);
      border-radius:32px;
      padding:clamp(16px, 2vh, 26px) clamp(20px, 2.4vw, 32px);
      border:1px solid rgba(0,0,0,.12);
      box-shadow:
        inset 0 3px 16px rgba(0,0,0,.24),
        0 12px 20px rgba(0,0,0,.14);
      backdrop-filter: blur(3px);
      flex-shrink:0;
    }
    .label{
      font-weight:900;
      opacity:.64;
      margin-bottom:10px;
      display:block;
      letter-spacing:2px;
      text-align:center;
      color:#111;
      font-size:0.95rem;
    }
    .content-text{
      font-size:clamp(1.08rem, 2vh, 1.38rem);
      line-height:1.85;
      font-weight:900;
      text-align:left;
      color:#0B0B0B;
      text-shadow:none;
      word-break:break-word;
    }

    /* æŠ½ç‰Œä¸­ï¼šä¸é¡¯ç¤ºè¨Šæ¯ */
    .spinning-placeholder{
      width:92%;
      min-height:200px;
      margin:0 auto;
      border-radius:32px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(0,0,0,.12);
      box-shadow:inset 0 2px 10px rgba(0,0,0,.16);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      letter-spacing:3px;
      opacity:.80;
      color:#111;
      flex:1 1 auto;
      font-size:1.1rem;
    }

    /* åº•éƒ¨ï¼šæ°¸é æ²‰åº•ï¼ˆåªåœ¨æŠ½ç‰Œå‰é¡¯ç¤ºï¼‰ */
    .footer{
      width:100%;
      margin-top:auto;
      padding-top:12px;
      padding-bottom:14px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:0;
      flex:0 0 auto;
    }

    /* é¦¬é›…é»èˆ‡æ§“åˆ»å°ï¼ˆåªåœ¨æŠ½ç‰Œå‰é¡¯ç¤ºï¼‰ */
    .ritual-etch{
      width:min(240px, 62%);
      height:34px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      background:
        radial-gradient(120px 22px at 50% 60%, rgba(255,255,255,.16), transparent 65%);
      border-radius:999px;
      filter: drop-shadow(0 11px 19px rgba(0,0,0,.20));
    }
    .ritual-etch::before{
      content:"";
      width:13px;height:13px;border-radius:50%;
      background:var(--theme);
      box-shadow:
        inset 0 -3px 5px rgba(0,0,0,.38),
        0 9px 15px rgba(0,0,0,.18);
    }
    .ritual-etch::after{
      content:"";
      width:min(164px, 43vw);
      height:13px;
      border-radius:13px;
      background:var(--theme);
      box-shadow:
        inset 0 -4px 6px rgba(0,0,0,.42),
        0 11px 19px rgba(0,0,0,.18);
    }

    /* æŠ½ç‰Œå‰ç•«é¢ï¼šæ›´å¤§æ°£ï¼ˆç¥å»Ÿé–‹å ´ï¼‰ */
    .pre-card{
      width:min(680px,88%);
      border-radius:56px;
      background:rgba(255,255,255,.11);
      border:2px solid rgba(0,0,0,.09);
      box-shadow:
        0 52px 98px rgba(0,0,0,.24),
        inset 0 3px 20px rgba(0,0,0,.20),
        inset 0 -1px 0 rgba(255,255,255,.38);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:26px;
      margin-top:clamp(20px, 4vh, 40px);
      padding:clamp(32px, 5vh, 50px) 20px;
      cursor:pointer;
      user-select:none;
      position:relative;
      transition: transform .25s ease;
    }
    .pre-card:hover{ transform: translateY(-4px); }
    .pre-inner{
      width:240px;height:240px;
      border-radius:38px;
      border:3px solid rgba(0,0,0,.11);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 24px 42px rgba(0,0,0,.20), inset 0 2px 14px rgba(0,0,0,.14);
      background:rgba(255,255,255,.08);
      color:var(--theme);
      font-weight:900;
      letter-spacing:3px;
      text-align:center;
      padding:12px;
      font-size:1.15rem;
    }
    .pre-title{
      font-weight:900;
      letter-spacing:12px;
      color:#222;
      font-size:2rem;
      text-align:center;
      margin-top:8px;
    }
    .pre-sub{
      opacity:.60;
      font-weight:800;
      letter-spacing:4px;
      font-size:1.18rem;
      text-align:center;
      margin-top:-6px;
    }

    @media (max-height: 760px){
      .tablet{ height:min(820px,90vh); }
      .glyph-img{height:160px;}
      .pre-inner{width:200px;height:200px;}
      .tone-area{ height:88px; flex-basis:88px; }
      .glyph-area{ flex-basis:184px; }
      .kin-id{ font-size:clamp(2.5rem, 4.2vh, 3.4rem); }
      .kin-name{ font-size:clamp(1.45rem, 2.8vh, 2rem); }
      .content-text{ font-size:clamp(1rem, 1.85vh, 1.24rem); line-height:1.75; }
      .msg-box{ padding:clamp(12px, 1.6vh, 20px) clamp(16px, 1.8vw, 24px); }
      .msg-stack{ gap:clamp(10px, 1.3vh, 14px); }
      .pre-card{ padding:clamp(24px, 4vh, 40px) 16px; }
      .pre-title{ font-size:1.7rem; letter-spacing:10px; }
      .content{ padding:clamp(24px, 3.5vh, 44px) clamp(20px, 3vw, 40px) clamp(20px, 2.5vh, 36px); }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const {useState,useEffect,useRef} = React;

    const TONE_NAMES=["ç£æ€§çš„","æœˆäº®çš„","é›»åŠ›çš„","è‡ªæˆ‘å­˜åœ¨çš„","è¶…é »çš„","éŸ»å¾‹çš„","å…±é³´çš„","éŠ€æ²³çš„","å¤ªé™½çš„","è¡Œæ˜Ÿçš„","å…‰è­œçš„","æ°´æ™¶çš„","å®‡å®™çš„"];
    const GLYPH_NAMES=["ç´…é¾","ç™½é¢¨","è—å¤œ","é»ƒç¨®å­","ç´…è›‡","ç™½ä¸–ç•Œæ©‹","è—æ‰‹","é»ƒæ˜Ÿæ˜Ÿ","ç´…æœˆ","ç™½ç‹—","è—çŒ´","é»ƒäºº","ç´…å¤©è¡Œè€…","ç™½å·«å¸«","è—é·¹","é»ƒæˆ°å£«","ç´…åœ°çƒ","ç™½é¡","è—é¢¨æš´","é»ƒå¤ªé™½"];

    const COLORS=["red","white","blue","yellow"];
    const THEME={
      red:{main:"#A5413F",bg:"#F8E8E8"},
      white:{main:"#666666",bg:"#F2F4F6"},
      blue:{main:"#3D5A73",bg:"#E8F0F8"},
      yellow:{main:"#B39B59",bg:"#F9F8E8"}
    };

    function RedRoom(){
      const [kin,setKin] = useState(1);
      const [history,setHistory] = useState([]);
      const [spinning,setSpinning] = useState(false);
      const [hasDrawn,setHasDrawn] = useState(false);
      const [showMessage,setShowMessage] = useState(false);
      const timerRef = useRef(null);

      const toneId = (kin - 1) % 13 + 1;
      const glyphId = (kin - 1) % 20;
      const theme = THEME[COLORS[(kin - 1) % 4]];

      const brain = window.RED_BRAIN_DATA || {};
      const data = brain[String(kin)] || {
        synchronicMessage: "å®‡å®™è¨Šæ¯å°é »ä¸­...",
        alignment: "è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª red-brain.js æ ¼å¼ã€‚"
      };

      useEffect(()=>{
        document.documentElement.style.setProperty("--bg", theme.bg);
        document.documentElement.style.setProperty("--theme", theme.main);
      },[theme.bg, theme.main]);

      const startSpin = ()=>{
        setHasDrawn(true);
        setSpinning(true);
        setShowMessage(false);
        clearInterval(timerRef.current);
        timerRef.current = setInterval(()=>{
          setKin(Math.floor(Math.random()*260) + 1);
        }, 65);
      };

      const stopSpin = ()=>{
        clearInterval(timerRef.current);
        setSpinning(false);
        setShowMessage(false);
        setTimeout(() => setShowMessage(true), 400);
        setHistory(prev => [kin, ...prev].slice(0,5));
      };

      const toggle = ()=>{
        if(spinning) stopSpin();
        else startSpin();
      };

      const manualInput = ()=>{
        const num = prompt("å¬å–šæŒ‡å®š KIN (1-260):", kin);
        const n = parseInt(num,10);
        if(!Number.isNaN(n) && n>=1 && n<=260){
          setHasDrawn(true);
          setKin(n);
          setShowMessage(false);
          setTimeout(() => setShowMessage(true), 100);
        }
      };

      return (
        <>
          <div className="history-sidebar">
            {history.map((k,i)=>(
              <div key={i} className="history-stone" onClick={()=>!spinning && setKin(k)}>{k}</div>
            ))}
          </div>

          <div style={{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}}>
            <div className="tablet">
              <div className="content">

                {!hasDrawn ? (
                  <>
                    <div className="pre-card" onClick={toggle}>
                      <div className="pre-inner">å°é »æº–å‚™ä¸­â€¦</div>
                      <div className="pre-title">é»æ“Šé–‹å§‹å°é »</div>
                      <div className="pre-sub">è·Ÿè‘—ç›´è¦ºï¼Œé–å®šå°è¨˜</div>
                    </div>

                    <div className="footer">
                      <div className="ritual-etch"></div>
                    </div>
                  </>
                ) : (
                  <>
                    <div className="tone-area">
                      <div className="tone-dots">
                        {[...Array(toneId % 5)].map((_,i)=><div key={i} className="tone-dot"></div>)}
                      </div>
                      <div className="tone-bars">
                        {[...Array(Math.floor(toneId / 5))].map((_,i)=><div key={i} className="tone-bar"></div>)}
                      </div>
                    </div>

                    <div className="glyph-area">
                      <div className="glyph-frame" onClick={toggle} title="é»åœ–é¨°ï¼šé–‹å§‹/åœæ­¢å°é »">
                        <img className="glyph-img" src={`../images/${String(glyphId + 1).padStart(2,'0')}.png`} />
                      </div>
                    </div>

                    <div className="kin-id" onClick={manualInput}>KIN {kin}</div>
                    <div className="kin-name">{TONE_NAMES[toneId-1]}{GLYPH_NAMES[glyphId]}</div>
                    <div className="name-etch"></div>

                    {spinning ? (
                      <div className="spinning-placeholder">å°é »ä¸­â€¦ï¼ˆåœæ­¢å¾Œé¡¯ç¤ºå®Œæ•´è¨Šæ¯ï¼‰</div>
                    ) : showMessage && (
                      <div className="msg-stack">
                        <div className="msg-box">
                          <span className="label">âš¡ èƒ½é‡æ„Ÿæ‡‰</span>
                          <div className="content-text">{data.synchronicMessage}</div>
                        </div>

                        <div className="msg-box">
                          <span className="label">ğŸŒ± èª¿é »å»ºè­°</span>
                          <div className="content-text">{data.alignment}</div>
                        </div>
                      </div>
                    )}
                  </>
                )}

              </div>
            </div>
          </div>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<RedRoom/>);
  </script>
</body>
</html>