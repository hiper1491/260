<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13月亮曆的小共時</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;600;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #E8E4DF;
            font-family: 'Noto Serif TC', serif;
            position: relative;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
        }

        .cover-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            padding: 60px 32px;
            max-width: 600px;
            width: 100%;
        }

        .hunab-ku-section {
            width: 140px;
            height: 140px;
        }

        .hunab-ku-icon {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
        }

        .cover-header {
            text-align: center;
        }

        .cover-title {
            font-size: 48px;
            font-weight: 900;
            letter-spacing: 0.12em;
            color: #2d2a26;
            margin-bottom: 16px;
            line-height: 1.3;
            text-shadow:
                1px 1px 1px rgba(255, 255, 255, 0.4),
                -1px -1px 1px rgba(0, 0, 0, 0.15);
        }

        .cover-subtitle {
            font-size: 16px;
            font-weight: 600;
            color: #6a655c;
            letter-spacing: 0.3em;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.3);
        }

        .daily-kin-card {
            background: #D5D0C8;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            border: 3px solid #c5c0b8;
            box-shadow:
                inset 0 2px 4px rgba(255, 255, 255, 0.3),
                inset 0 -2px 4px rgba(0, 0, 0, 0.08),
                0 8px 32px rgba(0, 0, 0, 0.12),
                0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .kin-label {
            font-size: 13px;
            font-weight: 600;
            color: #6a655c;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .kin-seal-container {
            width: 120px;
            height: 120px;
        }

        .kin-seal-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
        }

        .kin-name {
            font-size: 32px;
            font-weight: 900;
            color: #2d2a26;
            letter-spacing: 0.08em;
            text-align: center;
            text-shadow:
                1px 1px 1px rgba(255, 255, 255, 0.3),
                -1px -1px 1px rgba(0, 0, 0, 0.12);
        }

        .kin-number {
            font-size: 18px;
            font-weight: 700;
            color: #5a5650;
            letter-spacing: 0.1em;
        }

        .kin-date {
            font-size: 14px;
            font-weight: 500;
            color: #7a756c;
            letter-spacing: 0.05em;
        }

        .cover-action {
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .enter-button {
            display: inline-block;
            padding: 18px 48px;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: #f5f0eb;
            background: linear-gradient(135deg, #A84840 0%, #8a3a34 100%);
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow:
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 4px 12px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
        }

        .enter-button:hover {
            background: linear-gradient(135deg, #8a3a34 0%, #6a2a24 100%);
            transform: translateY(-2px);
            box-shadow:
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 6px 18px rgba(0, 0, 0, 0.3);
        }

        .cover-footer {
            text-align: center;
            font-size: 13px;
            color: #7a756c;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .kin-badge {
            font-weight: 700;
            color: #5a5650;
        }

        .social-links {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        .social-links a {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #c8c0b5;
            border-radius: 50%;
            color: #5a5650;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
        }

        .social-links a:hover {
            background: #a89040;
            color: #f8f6f2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.18);
        }

        @media (max-width: 600px) {
            .cover-container {
                padding: 40px 24px;
                gap: 32px;
            }

            .cover-title {
                font-size: 36px;
            }

            .cover-subtitle {
                font-size: 14px;
            }

            .hunab-ku-section {
                width: 110px;
                height: 110px;
            }

            .daily-kin-card {
                padding: 32px 24px;
            }

            .kin-name {
                font-size: 26px;
            }

            .enter-button {
                padding: 16px 40px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="cover-container">
        <!-- Hunab Ku 圖騰 -->
        <div class="hunab-ku-section">
            <img src="./images/hunab-ku-1.png" alt="Hunab Ku" class="hunab-ku-icon">
        </div>

        <!-- 標題 -->
        <header class="cover-header">
            <h1 class="cover-title">13月亮曆的小共時</h1>
            <p class="cover-subtitle">DREAMSPELL SYNCHRONICITY</p>
        </header>

        <!-- 今日能量卡片 -->
        <section class="daily-kin-card">
            <div class="kin-label">今日能量</div>
            <div class="kin-seal-container">
                <img id="kinSealImage" src="" alt="今日圖騰" class="kin-seal-image">
            </div>
            <h2 id="kinName" class="kin-name">計算中...</h2>
            <p id="kinNumber" class="kin-number"></p>
            <p id="kinDate" class="kin-date"></p>
        </section>

        <!-- 進入按鈕 -->
        <div class="cover-action">
            <a href="./index.html" class="enter-button">進入神廟</a>
        </div>

        <!-- Footer -->
        <footer class="cover-footer">
            <p>設計 | <span class="kin-badge">KIN 74 太陽的白巫師</span> HIPER</p>
            <div class="social-links">
                <a href="https://www.facebook.com/hiper.wu" target="_blank" title="Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="https://www.instagram.com/hiper.wu" target="_blank" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
        </footer>
    </div>

    <script>
        // ==================== 數據常數 ====================
        
        const MONTH_CONSTANTS = {
            1: 0, 2: 31, 3: 59, 4: 90, 5: 120, 6: 151,
            7: 181, 8: 212, 9: 243, 10: 13, 11: 44, 12: 74
        };

        const YEAR_CONSTANTS = {
            2014: 62, 2015: 167, 2016: 12, 2017: 117, 2018: 222,
            2019: 67, 2020: 172, 2021: 17, 2022: 122, 2023: 227,
            2024: 72, 2025: 177, 2026: 22, 2027: 127, 2028: 232,
            2029: 77, 2030: 182, 2031: 27, 2032: 132, 2033: 237,
            2034: 82, 2035: 187
        };

        const SEAL_NAMES = [
            "紅龍", "白風", "藍夜", "黃種子", "紅蛇",
            "白世界橋", "藍手", "黃星星", "紅月", "白狗",
            "藍猴", "黃人", "紅天行者", "白巫師", "藍鷹",
            "黃戰士", "紅地球", "白鏡", "藍風暴", "黃太陽"
        ];

        const TONE_NAMES = [
            "磁性的", "月亮的", "電力的", "自我存在的", "超頻的",
            "韻律的", "共振的", "銀河星系的", "太陽的", "行星的",
            "光譜的", "水晶的", "宇宙的"
        ];

        // ==================== 計算函數 ====================

        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        function calculateKin(year, month, day) {
            // 特殊處理：2月29日顯示 Hunab Ku
            if (month === 2 && day === 29) {
                return {
                    kin: null,
                    seal: null,
                    tone: null,
                    isHunabKu: true,
                    displayText: "Hunab Ku",
                    sealImagePath: "./images/hunab-ku-1.png"
                };
            }

            // 檢查年份常數
            if (!YEAR_CONSTANTS[year]) {
                console.warn(`年份 ${year} 的常數尚未定義`);
                return null;
            }

            // 基本計算
            let kin = YEAR_CONSTANTS[year] + MONTH_CONSTANTS[month] + day;

            // 閏年特殊規則：3月1日之後需要 +1
            if (isLeapYear(year) && (month > 2 || (month === 2 && day > 28))) {
                kin += 1;
            }

            // 限制在 1-260 範圍
            while (kin > 260) kin -= 260;
            while (kin < 1) kin += 260;

            // 計算圖騰和調性
            const sealIndex = ((kin - 1) % 20);
            const toneIndex = ((kin - 1) % 13);
            
            // 圖騰編號：1-20（對應圖片檔名）
            const sealNumber = sealIndex + 1;

            return {
                kin: kin,
                seal: SEAL_NAMES[sealIndex],
                tone: TONE_NAMES[toneIndex],
                sealNumber: sealNumber,
                isHunabKu: false,
                displayText: `${TONE_NAMES[toneIndex]}${SEAL_NAMES[sealIndex]}`,
                sealImagePath: `./images/${String(sealNumber).padStart(2, '0')}.png`
            };
        }

        // ==================== 初始化 ====================

        window.addEventListener('DOMContentLoaded', () => {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();

            console.log('=== Kin 計算 ===');
            console.log(`日期: ${year}/${month}/${day}`);

            const result = calculateKin(year, month, day);

            if (!result) {
                document.getElementById('kinName').textContent = '年份數據未定義';
                document.getElementById('kinNumber').textContent = '';
                document.getElementById('kinDate').textContent = `${year}.${String(month).padStart(2, '0')}.${String(day).padStart(2, '0')}`;
                return;
            }

            // 顯示日期
            const formattedDate = `${year}.${String(month).padStart(2, '0')}.${String(day).padStart(2, '0')}`;
            document.getElementById('kinDate').textContent = formattedDate;

            // 顯示圖騰圖片
            const sealImage = document.getElementById('kinSealImage');
            sealImage.src = result.sealImagePath;
            sealImage.alt = result.isHunabKu ? 'Hunab Ku' : `KIN ${result.kin} ${result.seal}`;

            // 處理圖片載入錯誤
            sealImage.onerror = function() {
                console.warn(`圖片載入失敗: ${result.sealImagePath}`);
                this.src = './images/hunab-ku-1.png';
            };

            // 顯示名稱和編號
            if (result.isHunabKu) {
                document.getElementById('kinName').textContent = result.displayText;
                document.getElementById('kinNumber').textContent = '';
                console.log('今日為 2/29，顯示 Hunab Ku');
            } else {
                document.getElementById('kinName').textContent = result.displayText;
                document.getElementById('kinNumber').textContent = `KIN ${result.kin}`;
                console.log(`KIN: ${result.kin} - ${result.displayText}`);
            }
        });
    </script>
</body>
</html>
